---
title: 虚拟dom,diff
date: 2022-5-24
categories: 
- frontend
tags:
- react，vue，dom,diff
- ts
---

## 虚拟dom是什么，有缺点
虚拟dom其实一个js树形tree对象,简化了真实渲染树
特点：
    1. 比较属性，减少dom操作，减少重绘和回流
    2. 有跨端能力，使用不同端编译器就可以实现跨端
缺点：
    1、对象是存储在内存中，耗费一定资源，加上而外算法
    2、超出dom列表，首次渲染还是比较慢

## diff算法
1. vue使用patching算法，snabbdom修改改进，由虚拟dom转换真实dom
2. vue中每个组件都对应一个watcher监听响应式数据，再通过patching算法找到发生变化地方，并修改更新
3. vue中diff执行是在于响应式数据发生更变，触发实例执行更新函数，更新函数会重新调用render方法，render函数返回新的虚拟dom,然后就执行patch函数进行对比，然后改变新值

## patch过程
执行一个递归过程，遵循深度优先，同层比较的策略
1. 比较两个节点类型是否想同，不同则删除重新创建
2. 如果是文本型的，就删除旧的，创建新的
3. 如果有子节点，有判断更更新
    1. 新子节点是文本，旧子节点是数组，则创建新的文本
    2. 新子节点是文本，旧子节点是文本，则更新文本
    3. 新子节点是数组，旧子节点是文本，则创建新子节点数组元素
    3. 新子节点是数组，旧子节点是数组，递归patch函数，通过双端比较
4. vue3.优化策略，编译优化添加patchFlags,
    - patchFlags 静态标记，
    - 静态提升，
    - 基于最长递增子序列进行移动/添加/删除

